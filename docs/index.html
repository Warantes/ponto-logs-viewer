<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registros de Ponto</title>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #121212; color: #fff; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px 12px; border: 1px solid #333; text-align: center; }
    th { background-color: #222; }
    .success { color: #0f0; }
    .fail { color: #f00; }
    .topbar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
    .filter { padding: 6px; margin: 0 4px; }
    #contador { margin-bottom: 10px; font-weight: bold; }
    .icon { font-size: 18px; }
  </style>
</head>
<body>
  <h2>✅ Registros de Ponto</h2>
  <div id="contador"></div>

  <table id="tabela">
    <thead>
      <tr>
        <th>Data</th>
        <th>Nome</th>
        <th>Entrada</th>
        <th>Saída</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    fetch('logs.json')
      .then(res => res.json())
      .then(dados => {
        const tabela = document.querySelector("#tabela tbody");

        // Contagem de registros totais, sucessos e falhas
        const total = dados.length;
        const sucessos = dados.filter(r => r.status.includes("Sucesso")).length;
        const falhas = dados.filter(r => r.status.includes("Falha")).length;
        const percentual = ((sucessos / total) * 100).toFixed(1);

        document.getElementById("contador").innerHTML = `
          <b>Total:</b> ${total} |
          <b>Sucessos:</b> ${sucessos} |
          <b>Falhas:</b> ${falhas} |
          <b>% Sucesso:</b> ${percentual}%
        `;

        // Agrupar por data + nome
        const agrupados = {};
        dados.forEach(r => {
          const key = `${r.data} - ${r.nome}`;
          if (!agrupados[key]) agrupados[key] = { entrada: null, saida: null };
          if (!agrupados[key].entrada && r.status.includes("Sucesso")) {
            agrupados[key].entrada = r.hora ? `${r.hora} ✅` : "❌";
          } else if (!agrupados[key].saida && r.status.includes("Sucesso")) {
            agrupados[key].saida = r.hora ? `${r.hora} ✅` : "❌";
          }
        });

        // Popular tabela
        Object.entries(agrupados).forEach(([key, val]) => {
          const [data, nome] = key.split(" - ");
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${data}</td>
            <td>${nome}</td>
            <td>${val.entrada || "❌"}</td>
            <td>${val.saida || "❌"}</td>
          `;
          tabela.appendChild(tr);
        });
      });
  </script>
</body>
</html>
